<html>
<head>
    <title>Drinking bird</title>
    <style>
        body {
            margin: 0;
        }

        canvas {
            width: 100%;
            height: 100%
        }
    </style>
</head>
<body>
<script src="../libs/three.js"></script>
<script src="../libs/orbitControls.js"></script>
<div id="container">
    <canvas id="canvas"></canvas>
</div>
<script>
  (function () {
    'use strict';

    var camera, scene, renderer, cameraControls;
    var clock = new THREE.Clock();

    function init() {
      renderer = new THREE.WebGLRenderer({antialias: true});
      renderer.setClearColor(new THREE.Color(0xAAAAAA), 1.0);
      renderer.setSize(window.innerWidth, window.innerHeight);

      camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 2000);
      camera.position.z = 150;

      cameraControls = new THREE.OrbitControls(camera, renderer.domElement);
      cameraControls.addEventListener('change', render); // remove when using animation loop
      cameraControls.enableZoom = false;

      fillScene();
    }

    function fillScene() {
      scene = new THREE.Scene();

      var ambientLight = new THREE.AmbientLight(0x383838);
      var light = new THREE.DirectionalLight(0xffffff, 1.0);
      light.position.set(100, 200, 300);

      scene.add(ambientLight);
      scene.add(light);
      scene.add(camera);

      createDrinkingBird();
    }

    function createLegs() {
      var cube, leftLeg, rightLeg, legs;
      var legMiddleMaterial, legBottomMaterial;

      leftLeg = new THREE.Object3D();
      rightLeg = new THREE.Object3D();
      legs = new THREE.Object3D();
      legMiddleMaterial = new THREE.MeshPhongMaterial({color: 0x3A3A3C, specular: 0x808080, shininess: 4});
      legBottomMaterial = new THREE.MeshPhongMaterial({color: 0x272324, specular: 0x808080, shininess: 10});

      //base
      cube = new THREE.Mesh(
        new THREE.CubeGeometry(180, 1, 180), new THREE.MeshBasicMaterial({color: 0x709288}));
      cube.position.x = 0;
      cube.position.y = -36;
      cube.position.z = -8;
      legs.add(cube);

      // left leg bottom
      cube = new THREE.Mesh(new THREE.CubeGeometry(16, 4, 3), legBottomMaterial);
      cube.position.x = 0;
      cube.position.y = -34;
      cube.position.z = 0;
      leftLeg.add(cube);

      // left leg middle
      cube = new THREE.Mesh(new THREE.CubeGeometry(5, 34, 2), legMiddleMaterial);
      cube.position.x = 5;
      cube.position.y = -16;
      cube.position.z = 0;
      leftLeg.add(cube);

      // right leg bottom
      cube = new THREE.Mesh(new THREE.CubeGeometry(16, 4, 3), legBottomMaterial);
      cube.position.x = 0;
      cube.position.y = -34;
      rightLeg.add(cube);

      // right leg middle
      cube = new THREE.Mesh(new THREE.CubeGeometry(5, 34, 2), legMiddleMaterial);
      cube.position.x = 5;
      cube.position.y = -16;
      rightLeg.add(cube);

      rightLeg.position.z = -20;

      legs.add(leftLeg);
      legs.add(rightLeg);
      scene.add(legs);
    }

    function createBody() {
      var body, backHeight, backRadius, bellyRadius, back, belly, sphere, cylinder, liquid;
      var bellyMaterial, backMaterial, liquidMaterial;

      body = new THREE.Object3D();
      liquid = new THREE.Object3D();
      backHeight = 50;
      backRadius = 2;
      bellyRadius = 8;
      backMaterial = new THREE.MeshPhongMaterial({color: 0x36BEAB, specular:  0x808080, shininess: 20, opacity: 0.3, transparent: true});
      bellyMaterial = new THREE.MeshPhongMaterial({color: 0x36BEAB, specular:  0x808080, shininess: 20, opacity: 0.3, transparent: true});
      liquidMaterial = new THREE.MeshPhongMaterial( { color: 0xE5559F, specular:  0x808080, shininess: 100 });

      back = new THREE.Mesh(new THREE.CylinderGeometry(backRadius, backRadius, backHeight, 40), backMaterial);
      belly = new THREE.Mesh(new THREE.SphereGeometry(bellyRadius, 40, 40), bellyMaterial);

      belly.position.y = -backHeight / 2;
      body.position.z = -10;
      body.position.x = 5;

      body.add(back);
      body.add(belly);

      // liquid in back
      sphere = new THREE.Mesh(new THREE.SphereGeometry( 7, 32, 16, 0, Math.PI * 2, Math.PI/2, Math.PI ), liquidMaterial);
      sphere.position.x = 0;
      sphere.position.y = 0;
      sphere.position.z = 0;
      liquid.add(sphere);

      // liquid in body start
      cylinder = new THREE.Mesh(
        new THREE.CylinderGeometry( 7, 7, 0, 32 ), liquidMaterial);
      cylinder.position.x = 0;
      cylinder.position.y = 0;
      cylinder.position.z = 0;
      liquid.add(cylinder);

      cylinder = new THREE.Mesh(new THREE.CylinderGeometry( 1, 1, 30, 32), liquidMaterial );
      cylinder.position.x = 0;
      cylinder.position.y = 10;
      cylinder.position.z = 0;
      liquid.add(cylinder);

      liquid.position.x = 5;
      liquid.position.z = -10;
      liquid.position.y = -25;
      // liquid in body end

      scene.add(body);
      scene.add(liquid);
    }

    function createHead() {
      var wholeHead, head, hat, headRadius, hatBottom, hatTop, hatBottomRadius, hatTopRadius;
      var hatTopMaterial, hatBottomMaterial;

      wholeHead = new THREE.Object3D();
      hat = new THREE.Object3D();
      headRadius = 8;
      hatBottomRadius = 10;
      hatTopRadius = 6;

      hatBottomMaterial = new THREE.MeshPhongMaterial({color: 0x313E93, specular: 0x808080, shininess: 100});
      hatTopMaterial = new THREE.MeshPhongMaterial({color: 0x313E93, specular: 0x000000, shininess: 100});

      head = new THREE.Mesh(new THREE.SphereGeometry(headRadius, 40, 40), new THREE.MeshLambertMaterial({color: 0x36BEAB}));

      hatTop = new THREE.Mesh(new THREE.CylinderGeometry(hatTopRadius, hatTopRadius, 14, 40), hatTopMaterial);
      hatTop.position.y = 7 + headRadius / 2;

      hatBottom = new THREE.Mesh(new THREE.CylinderGeometry(hatBottomRadius, hatBottomRadius, 2, 40), hatBottomMaterial);
      hatBottom.position.y = 1 + headRadius / 2;

      hat.add(hatTop);
      hat.add(hatBottom);
      wholeHead.add(head);
      wholeHead.add(hat);

      wholeHead.position.y = 25 + headRadius / 2;
      wholeHead.position.z = -10;
      wholeHead.position.x = 5;
      scene.add(wholeHead);
    }

    function createDrinkingBird() {
      createLegs();
      createBody();
      createHead();
    }

    function addToDOM() {
      var container = document.getElementById('container');
      var canvas = container.getElementsByTagName('canvas');

      if (canvas.length > 0) {
        container.removeChild(canvas[0]);
      }
      container.appendChild(renderer.domElement);
    }

    function animate() {
      var delta = clock.getDelta();

      window.requestAnimationFrame(animate);
      cameraControls.update(delta);
      render();
    }

    function render() {
      //createDrinkingBird();
      renderer.render(scene, camera);
    }

    try {
      init();
      addToDOM();
      animate();
    } catch (e) {
      var errorReport = "Your program encountered an unrecoverable error, can not draw on canvas. Error was:<br/><br/>";
      $('#container').append(errorReport + e);
    }
  })();
</script>
</body>
</html>
